# æ›´æ–°æ—¥å¿—

## ç§»é™¤ä¸å­˜åœ¨çš„è¯¦æƒ…é¡µé“¾æ¥ (2024-11-11)

### ğŸ› Bug ä¿®å¤

1. **404 é”™è¯¯ä¿®å¤**
   - ç§»é™¤äº†é•œåƒåˆ—è¡¨é¡µé¢ä¸­æŒ‡å‘ä¸å­˜åœ¨è¯¦æƒ…é¡µçš„é“¾æ¥
   - ç§»é™¤äº†å·åˆ—è¡¨é¡µé¢ä¸­æŒ‡å‘ä¸å­˜åœ¨è¯¦æƒ…é¡µçš„é“¾æ¥
   - ä¿®å¤äº†ç‚¹å‡»é•œåƒ ID æˆ–åç§°å¯¼è‡´ 404 çš„é—®é¢˜

### ğŸ“‹ ä¿®æ”¹çš„æ–‡ä»¶

- `app/images/page.tsx` - ç§»é™¤è¯¦æƒ…é¡µé“¾æ¥,æ”¹ä¸ºçº¯æ–‡æœ¬æ˜¾ç¤º
- `app/volumes/page.tsx` - ç§»é™¤è¯¦æƒ…é¡µé“¾æ¥,æ”¹ä¸ºçº¯æ–‡æœ¬æ˜¾ç¤º

### ğŸ“ è¯´æ˜

ç›®å‰åªæœ‰å®ä¾‹(instances)æœ‰è¯¦æƒ…é¡µã€‚é•œåƒ(images)ã€å·(volumes)ã€å¯†é’¥å¯¹(keypairs)çš„è¯¦æƒ…é¡µå°šæœªå®ç°ã€‚

## ä¿®å¤å®ä¾‹è¯¦æƒ…é¡µå­—æ®µåé”™è¯¯ (2024-11-11)

### ğŸ› Bug ä¿®å¤

1. **å®ä¾‹è¯¦æƒ…é¡µå­—æ®µåä¸åŒ¹é…**
   - âŒ ä¹‹å‰: ä½¿ç”¨ `status`, `memory`, `disk` å­—æ®µ
   - âœ… ç°åœ¨: ä½¿ç”¨ `state`, `memory_mb`, `volume_id` å­—æ®µ
   - ä¿®å¤äº† `Cannot read properties of undefined (reading 'toLowerCase')` é”™è¯¯

2. **API è¯·æ±‚å‚æ•°é”™è¯¯**
   - âŒ ä¹‹å‰: `instance_ids` (ä¸‹åˆ’çº¿å‘½å)
   - âœ… ç°åœ¨: `instanceIDs` (é©¼å³°å‘½å)

3. **æ“ä½œæŒ‰é’®å‘½å**
   - ä¿®å¤ "reboot" æ”¹ä¸º "restart" ä»¥åŒ¹é…åç«¯ API

### ğŸ“‹ ä¿®æ”¹çš„æ–‡ä»¶

- `app/instances/[id]/page.tsx` - ä¿®å¤æ‰€æœ‰å­—æ®µåå’Œ API è°ƒç”¨

### âœ… æ„å»ºç»“æœ

```
Route (app)                      Size     First Load JS
â”œ Æ’ /instances/[id]            3.91 kB  111 kB (åŠ¨æ€è·¯ç”±)
```

å®ä¾‹è¯¦æƒ…é¡µç°åœ¨å¯ä»¥æ­£å¸¸å·¥ä½œ,ä¸å†å´©æºƒã€‚

## ä¿®å¤ JSX æ¸²æŸ“å’Œç±»å‹é”™è¯¯ (2024-11-11)

### ğŸ› Bug ä¿®å¤

1. **æ¸²æŸ“å‡½æ•°è¿”å›ç±»å‹é”™è¯¯**
   - âŒ ä¹‹å‰: æ¸²æŸ“å‡½æ•°ç›´æ¥è¿”å›å­—ç¬¦ä¸²æˆ–æ•°å­—
   - âœ… ç°åœ¨: æ‰€æœ‰æ¸²æŸ“å‡½æ•°è¿”å› JSX å…ƒç´  (`<span>...</span>`)

2. **TypeScript ç±»å‹é”™è¯¯**
   - ä¿®å¤ `Type 'unknown' is not assignable to type 'ReactNode'`
   - æ‰€æœ‰ `unknown` ç±»å‹çš„å€¼éƒ½ä½¿ç”¨ `String()` æˆ– `Number()` è½¬æ¢åå†æ˜¾ç¤º

3. **React é‡å¤é”®è­¦å‘Š**
   - æ‰€æœ‰æ“ä½œåˆ—çš„ `key` å·²æ”¹ä¸º `"actions"`
   - ç¡®ä¿æ¯ä¸ªè¡¨æ ¼åˆ—éƒ½æœ‰å”¯ä¸€çš„ key

### ğŸ“‹ ä¿®æ”¹çš„æ–‡ä»¶

- `app/images/page.tsx` - ä¿®å¤ format, size_gb, created_at åˆ—çš„æ¸²æŸ“
- `app/instances/page.tsx` - ä¿®å¤ vcpus, memory_mb, image_id åˆ—çš„æ¸²æŸ“
- `app/volumes/page.tsx` - å·²æ­£ç¡®ä½¿ç”¨ JSX (æ— éœ€ä¿®æ”¹)
- `app/keypairs/page.tsx` - å·²æ­£ç¡®ä½¿ç”¨ JSX (æ— éœ€ä¿®æ”¹)

### âœ… æ„å»ºç»“æœ

```
Route (app)                      Size     First Load JS
â”Œ â—‹ /                           342 B    102 kB
â”œ â—‹ /images                     3.45 kB  110 kB
â”œ â—‹ /instances                  3.75 kB  110 kB
â”œ Æ’ /instances/[id]            3.9 kB   111 kB
â”œ â—‹ /keypairs                   3.62 kB  110 kB
â”” â—‹ /volumes                    4.19 kB  111 kB
```

## ä¿®å¤å•ä½å’Œå­—æ®µååŒ¹é…åç«¯API (2024-11-11)

### ğŸ”§ åç«¯ API å­—æ®µåä¿®æ­£

æ ¹æ®åç«¯ entity å®šä¹‰,ä¿®æ­£äº†æ‰€æœ‰å‰ç«¯é¡µé¢çš„å­—æ®µåå’Œå•ä½:

#### Instance (å®ä¾‹)
- âœ… å­—æ®µå: `state` (ä¸æ˜¯ `status`)
- âœ… å†…å­˜: `memory_mb` - å•ä½æ˜¯ **MB**
- âœ… CPU: `vcpus` - æ ¸æ•°
- âœ… ç£ç›˜: `size_gb` - å•ä½æ˜¯ **GB**

#### Volume (å·)
- âœ… IDå­—æ®µ: `volumeID` (ä¸æ˜¯ `id`)
- âœ… å¤§å°: `sizeGB` - å•ä½æ˜¯ **GB**
- âœ… çŠ¶æ€: `state` (ä¸æ˜¯ `status`)
- âœ… ç±»å‹: `volumeType`
- âœ… é™„åŠ ä¿¡æ¯: `attachments` æ•°ç»„

#### Image (é•œåƒ)
- âœ… å¤§å°: `size_gb` - å•ä½æ˜¯ **GB**
- âœ… çŠ¶æ€: `state` (ä¸æ˜¯ `status`)
- âœ… æ ¼å¼: `format` (qcow2, raw)

#### KeyPair (å¯†é’¥å¯¹)
- âœ… åˆ é™¤: `keypair_id` å­—æ®µ

### âœ¨ æ–°åŠŸèƒ½

1. **å®ä¾‹è¯¦æƒ…é¡µ** (`/instances/[id]`)
   - æ˜¾ç¤ºå®Œæ•´å®ä¾‹ä¿¡æ¯
   - æ”¯æŒå¯åŠ¨/åœæ­¢/é‡å¯/åˆ é™¤æ“ä½œ
   - é‡ç½®å¯†ç åŠŸèƒ½
   - SSH è¿æ¥å‘½ä»¤æç¤º

2. **åˆ—è¡¨é¡µæ”¹è¿›**
   - æ‰€æœ‰ ID åˆ—éƒ½å¯ç‚¹å‡»è·³è½¬è¯¦æƒ…
   - åç§°åˆ—éƒ½å¯ç‚¹å‡»è·³è½¬è¯¦æƒ…
   - æ­£ç¡®æ˜¾ç¤ºå•ä½ (MB è½¬ GB, GB ä¿æŒ)

3. **åˆ›å»ºè¡¨å•æ”¹è¿›**
   - å®ä¾‹: å†…å­˜æ˜¾ç¤º MB å’Œ GB åŒé‡æç¤º
   - å·: æ·»åŠ å·ç±»å‹é€‰æ‹© (GP2, GP3, IO1, Standard)
   - å¯†é’¥å¯¹: æ”¯æŒå¤šä¸ªå¯†é’¥å¯¹ ID(é€—å·åˆ†éš”)

### ğŸ› Bug ä¿®å¤

1. **å­—æ®µåä¸åŒ¹é…**
   - âŒ ä¹‹å‰: `name`, `status`, `memory`,`disk`, `instance_id`
   - âœ… ç°åœ¨: ä½¿ç”¨åç«¯æ­£ç¡®çš„å­—æ®µå

2. **å•ä½é”™è¯¯**
   - âŒ ä¹‹å‰: å†…å­˜æ˜¾ç¤ºä¸º `memory / 1024` (å‡è®¾å•ä½æ˜¯ KB)
   - âœ… ç°åœ¨: å†…å­˜æ˜¾ç¤ºä¸º `memory_mb / 1024` (å•ä½æ˜¯ MB)

3. **API å‚æ•°é”™è¯¯**
   - âŒ ä¹‹å‰: `{ instance_ids: [...] }` (å°å†™)
   - âœ… ç°åœ¨: `{ instanceIDs: [...] }` (é©¼å³°å‘½å)

### ğŸ“‹ API è¯·æ±‚ä½“æ ¼å¼

#### å®ä¾‹æ“ä½œ
```json
// æŸ¥è¯¢
POST /api/instances/describe
{}

// åˆ›å»º
POST /api/instances/run
{
  "image_id": "ubuntu-jammy",
  "size_gb": 20,
  "memory_mb": 2048,
  "vcpus": 2,
  "keypair_ids": ["kp-xxx"]
}

// å¯åŠ¨/åœæ­¢/é‡å¯
POST /api/instances/{action}
{
  "instanceIDs": ["i-xxx", "i-yyy"]
}
```

#### å·æ“ä½œ
```json
// åˆ›å»º
POST /api/volumes/create
{
  "sizeGB": 10,
  "volumeType": "gp2",
  "snapshotID": "snap-xxx"
}

// é™„åŠ 
POST /api/volumes/attach
{
  "volumeID": "vol-xxx",
  "instanceID": "i-xxx"
}
```

### ğŸ“Š æ„å»ºä¿¡æ¯

```
Route (app)                      Size     First Load JS
â”Œ â—‹ /                           342 B    102 kB
â”œ â—‹ /images                     3.43 kB  110 kB
â”œ â—‹ /instances                  3.75 kB  110 kB
â”œ Æ’ /instances/[id]            3.9 kB   111 kB  (åŠ¨æ€è·¯ç”±)
â”œ â—‹ /keypairs                   3.62 kB  110 kB
â”” â—‹ /volumes                    4.19 kB  111 kB
```

### ğŸ”— ç›¸å…³æ–‡æ¡£

- `API_MAPPING.md` - å®Œæ•´çš„ API æ˜ å°„æ–‡æ¡£
- `TROUBLESHOOTING.md` - æ•…éšœæ’æŸ¥æŒ‡å—
- `USAGE.md` - è¯¦ç»†ä½¿ç”¨è¯´æ˜

### âš ï¸ ç ´åæ€§å˜æ›´

å¦‚æœä½ ä¹‹å‰ä½¿ç”¨è¿‡æ—§ç‰ˆæœ¬å‰ç«¯,éœ€è¦æ³¨æ„:

1. æ‰€æœ‰APIå“åº”çš„å­—æ®µåå·²æ›´æ”¹,åŒ¹é…åç«¯entityå®šä¹‰
2. å•ä½æ˜¾ç¤ºå·²ä¿®æ­£ (å†…å­˜: MB, ç£ç›˜/å·: GB)
3. è¯·æ±‚ä½“å‚æ•°ä½¿ç”¨é©¼å³°å‘½å (å¦‚ `instanceIDs` ä¸æ˜¯ `instance_ids`)

### ğŸ¯ ä¸‹ä¸€æ­¥

å¯é€‰çš„åŠŸèƒ½å¢å¼º:

- [ ] å·è¯¦æƒ…é¡µ (`/volumes/[id]`)
- [ ] é•œåƒè¯¦æƒ…é¡µ (`/images/[id]`)
- [ ] å¿«ç…§ç®¡ç†åŠŸèƒ½
- [ ] æ‰¹é‡æ“ä½œ (é€‰ä¸­å¤šä¸ªèµ„æºæ‰§è¡Œæ“ä½œ)
- [ ] å®æ—¶çŠ¶æ€æ›´æ–° (WebSocket)
- [ ] æ€§èƒ½ç›‘æ§å›¾è¡¨
